select ar.arid, a.genre, a.releasedate, pr.last_played from "Artist" ar, "PublishesAlbum" p, "Album" a,
(select MAX(pr.time) last_played, a.aid FROM "PlayRecords" pr, "Album" a, "Song" s
 where s.aid = a.aid
 GROUP BY a.aid) as pr
where ar.arid = p.arid AND a.aid = p.aid AND pr.aid = p.aid
ORDER BY ar.arid, a.releasedate, pr.last_played ASC



select a.genre, a.releasedate, pr.last_played from "PublishesAlbum" p, "Album" a,
(select MAX(pr.time) last_played, a.aid FROM "PlayRecords" pr, "Album" a, "Song" s
 where s.aid = a.aid
 GROUP BY a.aid) as pr
where 45 = p.arid AND a.aid = p.aid AND pr.aid = p.aid
ORDER BY a.releasedate DESC


select a.genre, a.releasedate, pr.num from "PublishesAlbum" p, "Album" a,
(select COUNT(pr.time) num, a.aid FROM "PlayRecords" pr, "Album" a, "Song" s
 where s.aid = a.aid
 GROUP BY a.aid) as pr
where 45 = p.arid AND a.aid = p.aid AND pr.aid = p.aid
ORDER BY a.releasedate, pr.num DESC


select COUNT(pr.time) as num, a.aid FROM "PlayRecords" pr, "Album" a, "Song" s
where s.aid = a.aid
GROUP BY a.aid
ORDER BY a.aid DESC

select uc.name artist, pc.plays/uc.users::double precision ratio  from
(select COUNT(s.title) plays, ar.name  from "PlayRecords" pr, "Artist" ar, "Song" s, "Album" a, "PublishesAlbum" p
    where s.aid = a.aid AND p.aid = a.aid AND p.arid = ar.arid AND pr.sid = s.sid
    GROUP BY ar.name ) as pc
INNER JOIN
(select count(upa.username) users, upa.name from
(select ar.name, pr.username from  "PlayRecords" pr, "Artist" ar, "Song" s, "Album" a, "PublishesAlbum" p
    where s.aid = a.aid AND p.aid = a.aid AND p.arid = ar.arid AND pr.sid = s.sid
    GROUP BY pr.username,  ar.name) as upa
    GROUP BY upa.name) as uc
on pc.name = uc.name
order by ratio desc